<?xml version="1.0" encoding="utf-8"?>

<Elements xmlns="http://schemas.microsoft.com/sharepoint/">
    <Module Name="Assets">
        <File Path="Assets\genius\js\preload.js" Url="genius/js/preload.js" />
        <File Path="Assets\genius\js\genius.js" Url="genius/js/genius.js" />
    </Module>

    <CustomAction Location="ScriptLink" Sequence="1000"
                  ScriptBlock="genius = {
                                    preload: [],
                                    load: function(type, name, url, callback) {
                                        genius.preload.push({type: type, name: name, url: url, callback: callback});
                                    },
                                    loadScript: function(name, url, callback) {
                                        genius.load('script', name, url, callback);
                                    },
                                    loadStyle: function(name, url, callback) {
                                        genius.load('style', name, url, callback);
                                    }
                                };" />
    <CustomAction Location="ScriptLink" Sequence="1001"
                  ScriptBlock="var s=document.createElement('script');s.src='~site/genius/js/preload.js';document.head.appendChild(s);" />
    <CustomAction Location="ScriptLink" Sequence="1002"
                  ScriptBlock="genius.loadScript('jquery', '//cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js');" />
    <CustomAction Location="ScriptLink" Sequence="1003"
                  ScriptBlock="genius.loadScript('underscore', '//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js');" />
    <CustomAction Location="ScriptLink" Sequence="1004" ScriptBlock="genius.loadScript('~site/genius/js/genius.js');" />
</Elements>